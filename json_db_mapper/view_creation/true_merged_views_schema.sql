-- True Merged CSV-JSON Views Schema
-- CSV data enhanced with JSON data using COALESCE
-- Generated on: 2025-07-08 10:26:45

-- Drop existing views
DROP VIEW IF EXISTS view_csv_json_bills;
DROP VIEW IF EXISTS view_csv_json_contacts;
DROP VIEW IF EXISTS view_csv_json_credit_notes;
DROP VIEW IF EXISTS view_csv_json_customer_payments;
DROP VIEW IF EXISTS view_csv_json_invoices;
DROP VIEW IF EXISTS view_csv_json_items;
DROP VIEW IF EXISTS view_csv_json_purchase_orders;
DROP VIEW IF EXISTS view_csv_json_sales_orders;
DROP VIEW IF EXISTS view_csv_json_vendor_payments;

-- Create true merged views

-- True merged view for bills
CREATE VIEW IF NOT EXISTS view_csv_json_bills AS
SELECT 
    COALESCE(json.balance, csv.balance) AS balance,    COALESCE(json.bill_id, csv.bill_id) AS bill_id,    COALESCE(json.bill_number, csv.bill_number) AS bill_number,    COALESCE(json.branch_id, csv.branch_id) AS branch_id,    COALESCE(json.branch_name, csv.branch_name) AS branch_name,    COALESCE(json.currency_code, csv.currency_code) AS currency_code,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.due_date, csv.due_date) AS due_date,    COALESCE(json.exchange_rate, csv.exchange_rate) AS exchange_rate,    COALESCE(json.total, csv.total) AS total,    COALESCE(json.vendor_name, csv.vendor_name) AS vendor_name,    csv.account,    csv.account_code,    csv.accounts_payable,    csv.adjustment,    csv.adjustment_account,    csv.adjustment_description,    csv.approved_by,    csv.approved_date,    csv.bill_date,    csv.bill_status,    csv.bill_type,    csv.cf_chp_scheme_settlement_period,    csv.created_by,    csv.created_timestamp,    csv.customer_name,    csv.description,    csv.discount,    csv.discount_account,    csv.discount_account_code,    csv.discount_amount,    csv.discount_type,    csv.entity_discount_amount,    csv.entity_discount_percent,    csv.is_billable,    csv.is_discount_before_tax,    csv.is_inclusive_tax,    csv.is_landed_cost,    csv.item_name,    csv.item_total,    csv.payment_terms,    csv.payment_terms_label,    csv.product_id,    csv.project_name,    csv.purchase_order,    csv.purchase_order_number,    csv.quantity,    csv.rate,    csv.region,    csv.sku,    csv.submitted_by,    csv.submitted_date,    csv.subtotal,    csv.tax_amount,    csv.tax_id,    csv.tax_name,    csv.tax_percentage,    csv.tax_type,    csv.tds_amount,    csv.tds_name,    csv.tds_percentage,    csv.tds_type,    csv.terms_conditions,    csv.updated_timestamp,    csv.usage_unit,    csv.vehicle,    csv.vendor_notes,    json.attachment_name,    json.cf_chp_scheme_settlement_perio,    json.cf_chp_scheme_settlement_perio_unformatted,    json.client_viewed_time,    json.color_code,    json.created_time,    json.currency_id,    json.current_sub_status,    json.current_sub_status_id,    json.date,    json.due_days,    json.entity_type,    json.has_attachment,    json.is_bill_reconciliation_violated,    json.is_opening_balance,    json.is_tally_bill,    json.is_uber_bill,    json.is_viewed_by_client,    json.last_modified_time,    json.location_id,    json.price_precision,    json.reference_number,    json.status,    json.tags,    json.tds_total,    json.unprocessed_payment_amount,    json.vendor_id,    CASE WHEN json.bill_id IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_bills csv
LEFT JOIN json_bills json ON csv.bill_id = json.bill_id;

-- True merged view for contacts
CREATE VIEW IF NOT EXISTS view_csv_json_contacts AS
SELECT 
    COALESCE(json.cf_customer_category, csv.cf_customer_category) AS cf_customer_category,    COALESCE(json.cf_market_region, csv.cf_market_region) AS cf_market_region,    COALESCE(json.cf_special_scheme_targets, csv.cf_special_scheme_targets) AS cf_special_scheme_targets,    COALESCE(json.company_name, csv.company_name) AS company_name,    COALESCE(json.contact_id, csv.contact_id) AS contact_id,    COALESCE(json.contact_name, csv.contact_name) AS contact_name,    COALESCE(json.contact_type, csv.contact_type) AS contact_type,    COALESCE(json.created_time, csv.created_time) AS created_time,    COALESCE(json.currency_code, csv.currency_code) AS currency_code,    COALESCE(json.customer_sub_type, csv.customer_sub_type) AS customer_sub_type,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.facebook, csv.facebook) AS facebook,    COALESCE(json.first_name, csv.first_name) AS first_name,    COALESCE(json.last_modified_time, csv.last_modified_time) AS last_modified_time,    COALESCE(json.last_name, csv.last_name) AS last_name,    COALESCE(json.payment_terms, csv.payment_terms) AS payment_terms,    COALESCE(json.payment_terms_label, csv.payment_terms_label) AS payment_terms_label,    COALESCE(json.phone, csv.phone) AS phone,    COALESCE(json.source, csv.source) AS source,    COALESCE(json.status, csv.status) AS status,    COALESCE(json.twitter, csv.twitter) AS twitter,    COALESCE(json.website, csv.website) AS website,    csv.accounts_receivable,    csv.bank_account_payment,    csv.billing_address,    csv.billing_attention,    csv.billing_city,    csv.billing_code,    csv.billing_country,    csv.billing_county,    csv.billing_fax,    csv.billing_phone,    csv.billing_state,    csv.billing_street2,    csv.branch_id,    csv.branch_name,    csv.cf_customer_sales_executive,    csv.company_id,    csv.contact_address_id,    csv.created_timestamp,    csv.credit_limit,    csv.department,    csv.designation,    csv.display_name,    csv.email_id,    csv.last_sync_time,    csv.mobile_phone,    csv.notes,    csv.opening_balance,    csv.opening_balance_exchange_rate,    csv.owner_name,    csv.portal_enabled,    csv.price_list,    csv.primary_contact_id,    csv.region,    csv.salutation,    csv.shipping_address,    csv.shipping_attention,    csv.shipping_city,    csv.shipping_code,    csv.shipping_country,    csv.shipping_county,    csv.shipping_fax,    csv.shipping_phone,    csv.shipping_state,    csv.shipping_street2,    csv.siret,    csv.skype_identity,    csv.tax_name,    csv.tax_percentage,    csv.tax_type,    csv.taxable,    csv.track_tds,    csv.updated_timestamp,    csv.vehicle,    json.ach_supported,    json.cf_customer_category_unformatted,    json.cf_customer_owner,    json.cf_customer_owner_unformatted,    json.cf_market_region_unformatted,    json.cf_special_scheme_targets_unformatted,    json.contact_type_formatted,    json.created_time_formatted,    json.currency_id,    json.custom_field_hash,    json.custom_fields,    json.customer_credit_limit,    json.customer_name,    json.email,    json.has_attachment,    json.is_linked_with_zohocrm,    json.language_code,    json.language_code_formatted,    json.last_modified_time_formatted,    json.mobile,    json.outstanding_payable_amount,    json.outstanding_payable_amount_bcy,    json.outstanding_receivable_amount,    json.outstanding_receivable_amount_bcy,    json.portal_status,    json.portal_status_formatted,    json.tags,    json.unused_credits_payable_amount,    json.unused_credits_payable_amount_bcy,    json.unused_credits_receivable_amount,    json.unused_credits_receivable_amount_bcy,    json.vendor_name,    CASE WHEN json.last_modified_time IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_contacts csv
LEFT JOIN json_contacts json ON csv.contact_id = json.contact_id;

-- True merged view for credit_notes
CREATE VIEW IF NOT EXISTS view_csv_json_credit_notes AS
SELECT 
    COALESCE(json.balance, csv.balance) AS balance,    COALESCE(json.branch_id, csv.branch_id) AS branch_id,    COALESCE(json.branch_name, csv.branch_name) AS branch_name,    COALESCE(json.cf_modified, csv.cf_modified) AS cf_modified,    COALESCE(json.cf_region, csv.cf_region) AS cf_region,    COALESCE(json.cf_scheme_settlement_period, csv.cf_scheme_settlement_period) AS cf_scheme_settlement_period,    COALESCE(json.cf_scheme_type, csv.cf_scheme_type) AS cf_scheme_type,    COALESCE(json.currency_code, csv.currency_code) AS currency_code,    COALESCE(json.customer_id, csv.customer_id) AS customer_id,    COALESCE(json.customer_name, csv.customer_name) AS customer_name,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.exchange_rate, csv.exchange_rate) AS exchange_rate,    COALESCE(json.reference_number, csv.reference_number) AS reference_number,    COALESCE(json.total, csv.total) AS total,    csv.account,    csv.account_code,    csv.accounts_receivable,    csv.adjustment,    csv.adjustment_account,    csv.adjustment_description,    csv.applied_invoice_number,    csv.billing_address,    csv.billing_attention,    csv.billing_city,    csv.billing_code,    csv.billing_country,    csv.billing_fax,    csv.billing_phone,    csv.billing_state,    csv.billing_street_2,    csv.cf_dispatch_incomplete_but_scheme_passed,    csv.created_timestamp,    csv.credit_note_date,    csv.credit_note_number,    csv.credit_note_status,    csv.credit_notes_id,    csv.discount,    csv.discount_amount,    csv.discount_type,    csv.entity_discount_amount,    csv.entity_discount_percent,    csv.is_discount_before_tax,    csv.is_inclusive_tax,    csv.item_cf_sku_category,    csv.item_desc,    csv.item_name,    csv.item_price,    csv.item_tax,    csv.item_tax_amount,    csv.item_tax_percent,    csv.item_tax_type,    csv.item_total,    csv.kit_combo_item_name,    csv.notes,    csv.product_id,    csv.project_id,    csv.project_name,    csv.quantity,    csv.region,    csv.round_off,    csv.sales_person,    csv.shipping_address,    csv.shipping_attention,    csv.shipping_charge,    csv.shipping_charge_account,    csv.shipping_charge_tax_amount,    csv.shipping_charge_tax_id,    csv.shipping_charge_tax_name,    csv.shipping_charge_tax_percent,    csv.shipping_charge_tax_type,    csv.shipping_city,    csv.shipping_code,    csv.shipping_country,    csv.shipping_fax,    csv.shipping_phone,    csv.shipping_state,    csv.shipping_street_2,    csv.sku,    csv.subject,    csv.subtotal,    csv.tax1_id,    csv.tds_amount,    csv.tds_name,    csv.tds_percentage,    csv.tds_type,    csv.template_name,    csv.terms_conditions,    csv.updated_timestamp,    csv.usage_unit,    csv.vehicle,    json.applied_invoices,    json.cf_dispatch_incomplete_but_sch,    json.cf_dispatch_incomplete_but_sch_unformatted,    json.cf_modified_unformatted,    json.cf_region_unformatted,    json.cf_scheme_settlement_period_unformatted,    json.cf_scheme_type_unformatted,    json.client_viewed_time,    json.color_code,    json.created_time,    json.creditnote_id,    json.creditnote_number,    json.currency_id,    json.current_sub_status,    json.current_sub_status_id,    json.date,    json.has_attachment,    json.is_emailed,    json.is_viewed_by_client,    json.last_modified_time,    json.location_id,    json.price_precision,    json.rounding_mode,    json.salesperson_id,    json.salesperson_name,    json.status,    json.tags,    json.template_id,    json.template_type,    CASE WHEN json.reference_number IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_credit_notes csv
LEFT JOIN json_credit_notes json ON csv.credit_notes_id = json.creditnote_id;

-- True merged view for customer_payments
CREATE VIEW IF NOT EXISTS view_csv_json_customer_payments AS
SELECT 
    COALESCE(json.amount, csv.amount) AS amount,    COALESCE(json.branch_id, csv.branch_id) AS branch_id,    COALESCE(json.branch_name, csv.branch_name) AS branch_name,    COALESCE(json.created_time, csv.created_time) AS created_time,    COALESCE(json.customer_id, csv.customer_id) AS customer_id,    COALESCE(json.customer_name, csv.customer_name) AS customer_name,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.date, csv.date) AS date,    COALESCE(json.description, csv.description) AS description,    COALESCE(json.payment_number, csv.payment_number) AS payment_number,    COALESCE(json.payment_type, csv.payment_type) AS payment_type,    COALESCE(json.reference_number, csv.reference_number) AS reference_number,    COALESCE(json.unused_amount, csv.unused_amount) AS unused_amount,    csv.amount_applied_to_invoice,    csv.bank_charges,    csv.created_timestamp,    csv.currency_code,    csv.customer_payment_id,    csv.deposit_to,    csv.deposit_to_account_code,    csv.early_payment_discount,    csv.exchange_rate,    csv.invoice_date,    csv.invoice_number,    csv.invoice_payment_applied_date,    csv.invoice_payment_id,    csv.mode,    csv.payment_number_prefix,    csv.payment_number_suffix,    csv.tax_account,    csv.updated_timestamp,    csv.withholding_tax_amount,    json.account_id,    json.account_name,    json.applied_invoices,    json.bcy_amount,    json.bcy_refunded_amount,    json.bcy_unused_amount,    json.custom_fields_list,    json.documents,    json.gateway_transaction_id,    json.has_attachment,    json.invoice_numbers,    json.last_four_digits,    json.last_modified_time,    json.location_id,    json.payment_gateway,    json.payment_id,    json.payment_mode,    json.payment_mode_formatted,    json.payment_status,    json.retainerinvoice_id,    json.settlement_status,    json.tags,    json.tax_account_id,    json.tax_account_name,    json.tax_amount_withheld,    CASE WHEN json.amount IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_customer_payments csv
LEFT JOIN json_customer_payments json ON csv.ROWID = json.ROWID;

-- True merged view for invoices
CREATE VIEW IF NOT EXISTS view_csv_json_invoices AS
SELECT 
    COALESCE(json.adjustment, csv.adjustment) AS adjustment,    COALESCE(json.balance, csv.balance) AS balance,    COALESCE(json.billing_address, csv.billing_address) AS billing_address,    COALESCE(json.branch_id, csv.branch_id) AS branch_id,    COALESCE(json.branch_name, csv.branch_name) AS branch_name,    COALESCE(json.currency_code, csv.currency_code) AS currency_code,    COALESCE(json.customer_id, csv.customer_id) AS customer_id,    COALESCE(json.customer_name, csv.customer_name) AS customer_name,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.due_date, csv.due_date) AS due_date,    COALESCE(json.exchange_rate, csv.exchange_rate) AS exchange_rate,    COALESCE(json.invoice_id, csv.invoice_id) AS invoice_id,    COALESCE(json.invoice_number, csv.invoice_number) AS invoice_number,    COALESCE(json.last_payment_date, csv.last_payment_date) AS last_payment_date,    COALESCE(json.project_name, csv.project_name) AS project_name,    COALESCE(json.shipping_address, csv.shipping_address) AS shipping_address,    COALESCE(json.shipping_charge, csv.shipping_charge) AS shipping_charge,    COALESCE(json.total, csv.total) AS total,    csv.account,    csv.account_code,    csv.accounts_receivable,    csv.adjustment_account,    csv.adjustment_description,    csv.authorize_net,    csv.billing_attention,    csv.billing_city,    csv.billing_code,    csv.billing_country,    csv.billing_fax,    csv.billing_phone,    csv.billing_state,    csv.billing_street2,    csv.braintree,    csv.brand,    csv.cf_reason_to_void,    csv.company_id,    csv.created_timestamp,    csv.custom_charges,    csv.discount,    csv.discount_amount,    csv.discount_type,    csv.early_payment_discount_amount,    csv.early_payment_discount_due_days,    csv.early_payment_discount_percentage,    csv.entity_discount_amount,    csv.entity_discount_percent,    csv.estimate_number,    csv.expected_payment_date,    csv.expense_reference_id,    csv.forte,    csv.gocardless,    csv.google_checkout,    csv.icici_eazypay,    csv.invoice_date,    csv.invoice_status,    csv.is_discount_before_tax,    csv.is_inclusive_tax,    csv.item_cf_sku_category,    csv.item_desc,    csv.item_name,    csv.item_price,    csv.item_tax,    csv.item_tax_amount,    csv.item_tax_percent,    csv.item_tax_type,    csv.item_total,    csv.kit_combo_item_name,    csv.notes,    csv.partial_payments,    csv.payflow_pro,    csv.payment_terms,    csv.payment_terms_label,    csv.payments_pro,    csv.paypal,    csv.paytm,    csv.port_code,    csv.primary_contact_email_id,    csv.primary_contact_mobile,    csv.primary_contact_phone,    csv.product_id,    csv.project_id,    csv.purchase_order,    csv.quantity,    csv.razorpay,    csv.recurrence_name,    csv.region,    csv.round_off,    csv.sales_order_number,    csv.sales_person,    csv.shipping_attention,    csv.shipping_bill_date,    csv.shipping_bill_number,    csv.shipping_bill_total,    csv.shipping_charge_account,    csv.shipping_charge_tax_amount,    csv.shipping_charge_tax_id,    csv.shipping_charge_tax_name,    csv.shipping_charge_tax_percent,    csv.shipping_charge_tax_type,    csv.shipping_city,    csv.shipping_code,    csv.shipping_country,    csv.shipping_fax,    csv.shipping_phone_number,    csv.shipping_state,    csv.shipping_street2,    csv.sku,    csv.square,    csv.stripe,    csv.subject,    csv.subscription_id,    csv.subtotal,    csv.tax_id,    csv.tds_amount,    csv.tds_name,    csv.tds_percentage,    csv.tds_type,    csv.template_name,    csv.terms_conditions,    csv.two_checkout,    csv.updated_timestamp,    csv.usage_unit,    csv.vehicle,    csv.wepay,    csv.worldpay,    json.ach_payment_initiated,    json.client_viewed_time,    json.color_code,    json.company_name,    json.country,    json.created_by,    json.created_time,    json.currency_id,    json.currency_symbol,    json.current_sub_status,    json.current_sub_status_id,    json.custom_field_hash,    json.custom_fields,    json.date,    json.documents,    json.due_days,    json.email,    json.has_attachment,    json.invoice_url,    json.is_emailed,    json.is_viewed_by_client,    json.last_modified_time,    json.last_reminder_sent_date,    json.location_id,    json.no_of_copies,    json.payment_expected_date,    json.phone,    json.reference_number,    json.reminders_sent,    json.salesperson_id,    json.salesperson_name,    json.schedule_time,    json.show_no_of_copies,    json.status,    json.tags,    json.template_id,    json.template_type,    json.transaction_type,    json.unprocessed_payment_amount,    json.updated_time,    json.write_off_amount,    json.zcrm_potential_id,    json.zcrm_potential_name,    CASE WHEN json.due_date IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_invoices csv
LEFT JOIN json_invoices json ON csv.invoice_id = json.invoice_id;

-- True merged view for items
CREATE VIEW IF NOT EXISTS view_csv_json_items AS
SELECT 
    COALESCE(json.cf_item_location, csv.cf_item_location) AS cf_item_location,    COALESCE(json.cf_manufacturer, csv.cf_manufacturer) AS cf_manufacturer,    COALESCE(json.cf_product_category, csv.cf_product_category) AS cf_product_category,    COALESCE(json.cf_product_sale_category, csv.cf_product_sale_category) AS cf_product_sale_category,    COALESCE(json.cf_sku_category, csv.cf_sku_category) AS cf_sku_category,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.description, csv.description) AS description,    COALESCE(json.item_id, csv.item_id) AS item_id,    COALESCE(json.item_name, csv.item_name) AS item_name,    COALESCE(json.item_type, csv.item_type) AS item_type,    COALESCE(json.product_type, csv.product_type) AS product_type,    COALESCE(json.purchase_description, csv.purchase_description) AS purchase_description,    COALESCE(json.purchase_rate, csv.purchase_rate) AS purchase_rate,    COALESCE(json.rate, csv.rate) AS rate,    COALESCE(json.sku, csv.sku) AS sku,    COALESCE(json.source, csv.source) AS source,    COALESCE(json.status, csv.status) AS status,    COALESCE(json.stock_on_hand, csv.stock_on_hand) AS stock_on_hand,    COALESCE(json.tax_name, csv.tax_name) AS tax_name,    COALESCE(json.tax_percentage, csv.tax_percentage) AS tax_percentage,    csv.account,    csv.account_code,    csv.cf_m_box,    csv.cf_s_box_qty,    csv.created_timestamp,    csv.inventory_account,    csv.inventory_account_code,    csv.inventory_valuation_method,    csv.last_sync_time,    csv.opening_stock,    csv.opening_stock_value,    csv.purchase_account,    csv.purchase_account_code,    csv.purchase_tax_name,    csv.purchase_tax_percentage,    csv.purchase_tax_type,    csv.reference_id,    csv.region,    csv.reorder_point,    csv.tax_type,    csv.updated_timestamp,    csv.usage_unit,    csv.vehicle,    csv.vendor,    json.account_id,    json.account_name,    json.actual_available_stock,    json.available_stock,    json.can_be_purchased,    json.can_be_sold,    json.cf_item_location_unformatted,    json.cf_manufacturer_unformatted,    json.cf_product_category_unformatted,    json.cf_product_sale_category_unformatted,    json.cf_sku_category_unformatted,    json.created_time,    json.has_attachment,    json.image_document_id,    json.image_name,    json.image_type,    json.is_linked_with_zohocrm,    json.last_modified_time,    json.name,    json.purchase_account_id,    json.purchase_account_name,    json.reorder_level,    json.tags,    json.tax_id,    json.track_inventory,    json.unit,    json.zcrm_product_id,    CASE WHEN json.rate IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_items csv
LEFT JOIN json_items json ON csv.item_id = json.item_id;

-- True merged view for purchase_orders
CREATE VIEW IF NOT EXISTS view_csv_json_purchase_orders AS
SELECT 
    COALESCE(json.adjustment, csv.adjustment) AS adjustment,    COALESCE(json.adjustment_description, csv.adjustment_description) AS adjustment_description,    COALESCE(json.attention, csv.attention) AS attention,    COALESCE(json.branch_id, csv.branch_id) AS branch_id,    COALESCE(json.branch_name, csv.branch_name) AS branch_name,    COALESCE(json.currency_code, csv.currency_code) AS currency_code,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.delivery_date, csv.delivery_date) AS delivery_date,    COALESCE(json.discount, csv.discount) AS discount,    COALESCE(json.discount_amount, csv.discount_amount) AS discount_amount,    COALESCE(json.discount_type, csv.discount_type) AS discount_type,    COALESCE(json.exchange_rate, csv.exchange_rate) AS exchange_rate,    COALESCE(json.is_discount_before_tax, csv.is_discount_before_tax) AS is_discount_before_tax,    COALESCE(json.is_inclusive_tax, csv.is_inclusive_tax) AS is_inclusive_tax,    COALESCE(json.payment_terms, csv.payment_terms) AS payment_terms,    COALESCE(json.payment_terms_label, csv.payment_terms_label) AS payment_terms_label,    COALESCE(json.reference_number, csv.reference_number) AS reference_number,    COALESCE(json.submitted_by, csv.submitted_by) AS submitted_by,    COALESCE(json.submitted_date, csv.submitted_date) AS submitted_date,    COALESCE(json.template_name, csv.template_name) AS template_name,    COALESCE(json.total, csv.total) AS total,    COALESCE(json.vendor_name, csv.vendor_name) AS vendor_name,    csv.account,    csv.account_code,    csv.address,    csv.approved_by,    csv.approved_date,    csv.city,    csv.code,    csv.country,    csv.created_timestamp,    csv.deliver_to_customer,    csv.delivery_instructions,    csv.discount_account,    csv.discount_account_code,    csv.entity_discount_amount,    csv.entity_discount_percent,    csv.expected_arrival_date,    csv.item_desc,    csv.item_name,    csv.item_price,    csv.item_tax,    csv.item_tax_amount,    csv.item_tax_percent,    csv.item_tax_type,    csv.item_total,    csv.phone,    csv.product_id,    csv.project_id,    csv.project_name,    csv.purchase_order_date,    csv.purchase_order_id,    csv.purchase_order_number,    csv.purchase_order_status,    csv.quantity_billed,    csv.quantity_cancelled,    csv.quantity_ordered,    csv.quantity_received,    csv.recipient_address,    csv.recipient_city,    csv.recipient_country,    csv.recipient_phone,    csv.recipient_postal_code,    csv.recipient_state,    csv.reference_no,    csv.region,    csv.shipment_preference,    csv.sku,    csv.state,    csv.tax_id,    csv.tds_amount,    csv.tds_name,    csv.tds_percentage,    csv.tds_type,    csv.terms_conditions,    csv.updated_timestamp,    csv.usage_unit,    csv.vehicle,    json.advances,    json.approver_id,    json.approvers_list,    json.attachment_name,    json.billed_status,    json.billing_address,    json.billing_address_id,    json.bills,    json.can_mark_as_bill,    json.can_mark_as_unbill,    json.can_send_in_mail,    json.client_viewed_time,    json.color_code,    json.company_name,    json.computation_type,    json.contact_category,    json.contact_persons,    json.contact_persons_associated,    json.created_by_id,    json.created_time,    json.currency_id,    json.currency_symbol,    json.current_sub_status,    json.current_sub_status_id,    json.custom_field_hash,    json.custom_fields,    json.date,    json.delivery_address,    json.delivery_customer_address_id,    json.delivery_customer_id,    json.delivery_days,    json.delivery_org_address_id,    json.discount_account_id,    json.discount_account_name,    json.discount_applied_on_amount,    json.discount_percent,    json.discount_total,    json.documents,    json.due_by_days,    json.due_in_days,    json.expected_delivery_date,    json.has_attachment,    json.has_qty_cancelled,    json.is_adv_tracking_in_receive,    json.is_emailed,    json.is_po_marked_as_received,    json.is_viewed_by_client,    json.last_modified_time,    json.line_items,    json.location_id,    json.location_name,    json.notes,    json.order_status,    json.orientation,    json.page_height,    json.page_width,    json.price_precision,    json.purchaseorder_id,    json.purchaseorder_number,    json.quantity_marked_as_received,    json.quantity_yet_to_receive,    json.received_status,    json.receives,    json.salesorders,    json.ship_via,    json.ship_via_id,    json.status,    json.sub_statuses,    json.sub_total,    json.sub_total_inclusive_of_tax,    json.submitted_by_email,    json.submitted_by_name,    json.submitted_by_photo_url,    json.submitter_id,    json.tags,    json.tax_override_preference,    json.tax_rounding,    json.tax_total,    json.taxes,    json.tds_calculation_type,    json.tds_override_preference,    json.tds_summary,    json.template_id,    json.template_type,    json.terms,    json.total_quantity,    json.vendor_id,    CASE WHEN json.is_inclusive_tax IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_purchase_orders csv
LEFT JOIN json_purchase_orders json ON csv.ROWID = json.ROWID;

-- True merged view for sales_orders
CREATE VIEW IF NOT EXISTS view_csv_json_sales_orders AS
SELECT 
    COALESCE(json.branch_id, csv.branch_id) AS branch_id,    COALESCE(json.branch_name, csv.branch_name) AS branch_name,    COALESCE(json.cf_region, csv.cf_region) AS cf_region,    COALESCE(json.currency_code, csv.currency_code) AS currency_code,    COALESCE(json.customer_id, csv.customer_id) AS customer_id,    COALESCE(json.customer_name, csv.customer_name) AS customer_name,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.delivery_method, csv.delivery_method) AS delivery_method,    COALESCE(json.quantity_invoiced, csv.quantity_invoiced) AS quantity_invoiced,    COALESCE(json.reference_number, csv.reference_number) AS reference_number,    COALESCE(json.source, csv.source) AS source,    COALESCE(json.status, csv.status) AS status,    COALESCE(json.total, csv.total) AS total,    csv.account,    csv.account_code,    csv.adjustment,    csv.adjustment_description,    csv.billing_address,    csv.billing_city,    csv.billing_code,    csv.billing_country,    csv.billing_fax,    csv.billing_phone,    csv.billing_state,    csv.billing_street2,    csv.cf_pending_items_delivery,    csv.created_timestamp,    csv.custom_status,    csv.discount,    csv.discount_amount,    csv.discount_type,    csv.entity_discount_amount,    csv.entity_discount_percent,    csv.exchange_rate,    csv.expected_shipment_date,    csv.is_discount_before_tax,    csv.is_inclusive_tax,    csv.item_cf_sku_category,    csv.item_desc,    csv.item_name,    csv.item_price,    csv.item_tax,    csv.item_tax_amount,    csv.item_tax_percent,    csv.item_tax_type,    csv.item_total,    csv.kit_combo_item_name,    csv.notes,    csv.order_date,    csv.payment_terms,    csv.payment_terms_label,    csv.product_id,    csv.project_id,    csv.project_name,    csv.quantity_cancelled,    csv.quantity_ordered,    csv.region,    csv.sales_order_id,    csv.sales_order_number,    csv.sales_person,    csv.shipping_address,    csv.shipping_charge,    csv.shipping_charge_tax_amount,    csv.shipping_charge_tax_id,    csv.shipping_charge_tax_name,    csv.shipping_charge_tax_percent,    csv.shipping_charge_tax_type,    csv.shipping_city,    csv.shipping_code,    csv.shipping_country,    csv.shipping_fax,    csv.shipping_phone,    csv.shipping_state,    csv.shipping_street2,    csv.sku,    csv.subtotal,    csv.tax_id,    csv.tds_amount,    csv.tds_name,    csv.tds_percentage,    csv.tds_type,    csv.template_name,    csv.terms_conditions,    csv.updated_timestamp,    csv.usage_unit,    csv.vehicle,    json.bcy_total,    json.cf_region_unformatted,    json.color_code,    json.company_name,    json.created_time,    json.currency_id,    json.current_sub_status,    json.current_sub_status_id,    json.custom_fields_list,    json.date,    json.delivery_date,    json.delivery_method_id,    json.due_by_days,    json.due_in_days,    json.email,    json.has_attachment,    json.invoiced_status,    json.invoiced_sub_status,    json.invoiced_sub_status_id,    json.is_emailed,    json.is_manually_fulfilled,    json.is_scheduled_for_quick_shipment_create,    json.is_viewed_in_mail,    json.last_modified_time,    json.location_id,    json.mail_first_viewed_time,    json.mail_last_viewed_time,    json.order_fulfillment_type,    json.order_status,    json.order_sub_status,    json.order_sub_status_id,    json.paid_status,    json.pickup_location_id,    json.salesorder_id,    json.salesorder_number,    json.salesperson_name,    json.shipment_date,    json.shipment_days,    json.shipped_status,    json.tags,    json.total_invoiced_amount,    json.zcrm_potential_id,    json.zcrm_potential_name,    CASE WHEN json.reference_number IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_sales_orders csv
LEFT JOIN json_sales_orders json ON csv.ROWID = json.ROWID;

-- True merged view for vendor_payments
CREATE VIEW IF NOT EXISTS view_csv_json_vendor_payments AS
SELECT 
    COALESCE(json.amount, csv.amount) AS amount,    COALESCE(json.branch_id, csv.branch_id) AS branch_id,    COALESCE(json.branch_name, csv.branch_name) AS branch_name,    COALESCE(json.currency_code, csv.currency_code) AS currency_code,    COALESCE(json.data_source, csv.data_source) AS data_source,    COALESCE(json.date, csv.date) AS date,    COALESCE(json.description, csv.description) AS description,    COALESCE(json.exchange_rate, csv.exchange_rate) AS exchange_rate,    COALESCE(json.payment_number, csv.payment_number) AS payment_number,    COALESCE(json.reference_number, csv.reference_number) AS reference_number,    COALESCE(json.vendor_name, csv.vendor_name) AS vendor_name,    csv.bank_reference_number,    csv.bill_amount,    csv.bill_date,    csv.bill_number,    csv.bill_payment_applied_date,    csv.created_timestamp,    csv.email_id,    csv.mode,    csv.paid_through,    csv.paid_through_account_code,    csv.payment_number_prefix,    csv.payment_number_suffix,    csv.payment_status,    csv.pi_payment_id,    csv.tax_account,    csv.unused_amount,    csv.updated_timestamp,    csv.vendor_payment_id,    csv.withholding_tax_amount,    csv.withholding_tax_amount_bcy,    json.ach_gw_transaction_id,    json.ach_payment_status,    json.balance,    json.bcy_amount,    json.bcy_balance,    json.bill_numbers,    json.check_details,    json.created_time,    json.currency_id,    json.has_attachment,    json.is_ach_payment,    json.is_paid_via_print_check,    json.last_modified_time,    json.location_id,    json.paid_through_account_id,    json.paid_through_account_name,    json.payment_id,    json.payment_mode,    json.status,    json.tags,    json.vendor_id,    CASE WHEN json.amount IS NOT NULL THEN 'json' ELSE 'csv' END AS data_source
FROM csv_vendor_payments csv
LEFT JOIN json_vendor_payments json ON csv.ROWID = json.ROWID;
